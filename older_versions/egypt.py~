#!/usr/bin/python
# -*- coding:utf-8 -*-

import pygame, sys, random
from pygame.locals import *

#---COLORS-------------------------------------------------------------

#           R   G    B

WHITE =  ( 255, 255, 255)
BLUE =   (   0,   0, 255)
GREEN =  (   0, 255,   0)
RED =    ( 255,   0,   0)
YELLOW = ( 255, 220,  50)


#----------------------------------------------------------------------

# These variables won’t change.

FPS = 30

# These are the blocks sizes.
BLOCKSIZEy = 150
BLOCKSIZEx = 150
# These are the numbers of blocks.
NUMBERBLOCKSx = 3
NUMBERBLOCKSy = 3

INTERFACE = 1

BGCOLOR = WHITE


#---PLACES----------------------------------------------------------

WATER = BLUE
LAND = GREEN
YOU = RED
THE_OTHER = YELLOW

#----------------------------------------------------------------------

pygame.init()
DISPLAYSURF = pygame.display.set_mode(((BLOCKSIZEx * (NUMBERBLOCKSx)), (BLOCKSIZEy * (NUMBERBLOCKSy + INTERFACE))))
pygame.display.set_caption('Gaule')

DISPLAYSURF.fill(BGCOLOR)

#------------------------------------------------------------------

def main():
    global FPSCLOCK, DISPLAYSURF
    FPSCLOCK = pygame.time.Clock()
    
    mousex = 0
    mousey = 0
    
    theMap = createMap()
    
    while True: # main game loop
        mouseClicked = False
        
        drawMap(theMap)
        
        for event in pygame.event.get():
            if event.type == QUIT:
                pygame.quit()
                sys.exit()
            elif event.type == MOUSEMOTION:
                mousex, mousey = event.pos
            elif event.type == MOUSEBUTTONUP:
                mousex, mousey = event.pos
                mouseClicked = True
        blockx, blocky = getBlockAtPixel(mousex, mousey)
        if blockx != None and blocky != None and mouseClicked:
            print '{}, {}'.format(blockx, blocky)
        pygame.display.update()
        FPSCLOCK.tick(FPS)

def leftTopCoordsOfBlock(blockx, blocky):
    # Convert map coordinates to pixel coordinates.
    left = blockx * BLOCKSIZEx
    top = blocky * BLOCKSIZEy
    return (left, top)

def getBlockAtPixel(x, y):
    for blockx in range(NUMBERBLOCKSx):
        for blocky in range(NUMBERBLOCKSy):
            left, top = leftTopCoordsOfBlock(blockx, blocky)
            blockRect = pygame.Rect(left, top, BLOCKSIZEx, BLOCKSIZEy)
            if blockRect.collidepoint(x, y):
                return (blockx, blocky)
    return (None, None)

def createMap():
    # Create the map
    # Omg make all this more flexible orz.
    
    # Regions
    R00 = {'land': False, 'faction': WATER, 'pop': 0, 'agrable_level': 0, 'prey_level': 0, 'fish_level': 3, 'flint_tonne': 0}
    R01 = {'land': False, 'faction': WATER, 'pop': 0, 'agrable_level': 0, 'prey_level': 0, 'fish_level': 5, 'flint_tonne': 0}
    R02 = {'land': True, 'faction': YOU, 'pop': 120, 'agrable_level': 3, 'prey_level': 2, 'fish_level': 2, 'flint_tonne': 2000}
    R10 = {'land': False, 'faction': WATER, 'pop': 0, 'agrable_level': 0, 'prey_level': 0, 'fish_level': 4, 'flint_tonne': 0}
    R11 = {'land': True, 'faction': YOU, 'pop': 100, 'agrable_level': 2, 'prey_level': 3, 'fish_level': 1, 'flint_tonne': 100}
    R12 = {'land': True, 'faction': YOU, 'pop': 100, 'agrable_level': 3, 'prey_level': 3, 'fish_level': 1, 'flint_tonne': 230}
    R20 = {'land': True, 'faction': THE_OTHER, 'pop': 100, 'agrable_level': 2, 'prey_level': 3, 'fish_level': 3, 'flint_tonne': 3500}
    R21 = {'land': True, 'faction': THE_OTHER, 'pop': 130, 'agrable_level': 4, 'prey_level': 2, 'fish_level': 3, 'flint_tonne': 500}
    R22 = {'land': True, 'faction': THE_OTHER, 'pop': 100, 'agrable_level': 4, 'prey_level': 2, 'fish_level': 1, 'flint_tonne': 100}
    
    # Columns of regions
    col0 = R00, R01, R02
    col1 = R10, R11, R12
    col2 = R20, R21, R22
    
    theMap = col0, col1, col2,
    
    return theMap

def getColor(theMap, blockx, blocky):
    # color value for x, y spot is stored in TheMap[x][y]['faction']
    return theMap[blockx][blocky]['faction']

def drawMap(theMap):
    # Draws all the blocks.
    for blockx in range(NUMBERBLOCKSx):
        for blocky in range(NUMBERBLOCKSy):
            left, top = leftTopCoordsOfBlock(blockx, blocky)
            color = getColor(theMap, blockx, blocky)
            pygame.draw.rect(DISPLAYSURF, color, (left, top, BLOCKSIZEx, BLOCKSIZEy))
    
main()
